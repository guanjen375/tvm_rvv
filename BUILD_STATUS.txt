====================================================================== 
TVM my_device LLVM Codegen é…ç½®æª¢æŸ¥å ±å‘Š
======================================================================
æ—¥æœŸï¼š2025-10-02
æª¢æŸ¥å°è±¡ï¼š/home/david/tvm/build

======================================================================
âœ… é…ç½®ç‹€æ…‹ï¼šæ­£ç¢º
======================================================================

åœ¨ build/config.cmake ä¸­æ‰¾åˆ°ï¼š

  ç¬¬ 154 è¡Œï¼šset(USE_LLVM /home/david/Downloads/clang+llvm-18.1.7-x86_64-linux-gnu-ubuntu-18.04/bin/llvm-config)
  ç¬¬ 155 è¡Œï¼šset(TVM_MY_DEVICE_USE_LLVM ON)

çµè«–ï¼šé…ç½®æ­£ç¢ºï¼my_device å·²è¨­å®šä½¿ç”¨ LLVM backendã€‚

======================================================================
ğŸ“ å·²æ·»åŠ çš„ Debug è¨Šæ¯
======================================================================

ç‚ºäº†è¿½è¹¤å¯¦éš›åŸ·è¡Œè·¯å¾‘ï¼Œåœ¨ä»¥ä¸‹æ–‡ä»¶ä¸­æ·»åŠ äº† LOG(INFO) è¨Šæ¯ï¼š

1. src/target/source/codegen_my_device.cc (ç¬¬ 419, 478 è¡Œ)
   - LLVM æ¨¡å¼ï¼š[my_device codegen] Using LLVM backend mode
   - C++ æ¨¡å¼ï¼š[my_device codegen] Using C++ source codegen + runtime compilation mode

2. src/runtime/my_device/my_device_module.cc (ç¬¬ 58, 119, 126 è¡Œ)  
   - è¼‰å…¥æ¨¡çµ„ï¼š[my_device runtime] Loading my_device binary module (C++ runtime mode)
   - åŸ·è¡Œå‡½æ•¸ï¼š[my_device runtime] Invoking C++ runtime dynamic compilation for function: XXX

======================================================================
ğŸ” å¦‚ä½•é©—è­‰
======================================================================

æ–¹æ³• 1ï¼šç·¨è­¯ rvv_test.py ä¸¦æª¢æŸ¥è¨Šæ¯
-----------------------------------
ç”±æ–¼æœ‰ libstdc++ ç‰ˆæœ¬è¡çªï¼Œéœ€ä½¿ç”¨ç³»çµ± Pythonï¼š

  export LD_LIBRARY_PATH=/usr/lib/x86_64-linux-gnu:/usr/local/lib
  /usr/bin/python3 rvv_test.py mobilenet 2>&1 | tee output.txt
  grep "my_device codegen" output.txt

é æœŸçœ‹åˆ°ï¼ˆLLVM æ¨¡å¼ï¼‰ï¼š
  âœ“ [INFO] [my_device codegen] Using LLVM backend mode

å¦‚æœçœ‹åˆ°ï¼ˆC++ æ¨¡å¼ï¼Œéœ€é‡æ–°ç·¨è­¯ï¼‰ï¼š
  âœ— [INFO] [my_device codegen] Using C++ source codegen + runtime compilation mode

æ–¹æ³• 2ï¼šæª¢æŸ¥ç·¨è­¯æ™‚çš„å®å®šç¾©
--------------------------
  cd build
  make VERBOSE=1 2>&1 | grep codegen_my_device.cc | grep "\-D.*LLVM"

æ‡‰è©²åŒ…å«ï¼š
  -DTVM_MY_DEVICE_USE_LLVM=1

æ–¹æ³• 3ï¼šç¢ºä¿ CMakeCache.txt æ­£ç¢º
-------------------------------
  grep TVM_MY_DEVICE_USE_LLVM build/CMakeCache.txt

æ‡‰è©²é¡¯ç¤ºï¼š
  TVM_MY_DEVICE_USE_LLVM:BOOL=ON

======================================================================
âš ï¸ Libstdc++ ç‰ˆæœ¬è¡çª
======================================================================

éŒ¯èª¤è¨Šæ¯ï¼š
  OSError: libstdc++.so.6: version `GLIBCXX_3.4.30' not found

åŸå› ï¼š
  TVM ä½¿ç”¨ç³»çµ± GCC 11+ ç·¨è­¯ï¼ŒConda ç’°å¢ƒçš„ libstdc++ å¤ªèˆŠ

è§£æ±ºæ–¹æ¡ˆï¼š
  A) ä½¿ç”¨ç³»çµ± Pythonï¼š
     /usr/bin/python3 rvv_test.py mobilenet

  B) æ›´æ–° Conda libstdc++ï¼š
     conda install -c conda-forge libstdcxx-ng

  C) è¨­ç½® LD_LIBRARY_PATHï¼š
     export LD_LIBRARY_PATH=/usr/lib/x86_64-linux-gnu:$LD_LIBRARY_PATH

======================================================================
ğŸ“‹ é©—è­‰æ¸…å–®
======================================================================

é…ç½®éšæ®µï¼š
  [âœ“] USE_LLVM å·²è¨­ç½®
  [âœ“] TVM_MY_DEVICE_USE_LLVM=ON åœ¨ config.cmake
  [ ] é‡æ–°ç·¨è­¯ TVMï¼ˆå¦‚æœä¹‹å‰æ²’æœ‰é€™å€‹è¨­ç½®ï¼‰
  [ ] ç¢ºèªç·¨è­¯æ™‚ä½¿ç”¨äº† -DTVM_MY_DEVICE_USE_LLVM=1

ç·¨è­¯æ¨¡å‹æ™‚ï¼š
  [ ] çœ‹åˆ° "[my_device codegen] Using LLVM backend mode"
  [ ] æ²’æœ‰çœ‹åˆ° "Using C++ source codegen"
  [ ] æˆåŠŸç”Ÿæˆ .so æ–‡ä»¶

åŸ·è¡Œæ™‚ï¼ˆå¦‚æœæ¸¬è©¦ run.pyï¼‰ï¼š
  [ ] æ²’æœ‰çœ‹åˆ° "[my_device runtime] Loading my_device binary module"
  [ ] æ²’æœ‰çœ‹åˆ° "call c++ runtime"
  [ ] æ­£å¸¸åŸ·è¡Œï¼Œç„¡ "Cannot find function" éŒ¯èª¤

======================================================================
ğŸš€ ä¸‹ä¸€æ­¥è¡Œå‹•
======================================================================

1. ç¢ºèª TVM æ˜¯å¦ç”¨ç•¶å‰é…ç½®é‡æ–°ç·¨è­¯éï¼š

   cd build
   grep TVM_MY_DEVICE_USE_LLVM CMakeCache.txt

   å¦‚æœæ²’æœ‰é¡¯ç¤º ONï¼ŒåŸ·è¡Œï¼š
   rm -rf CMakeFiles CMakeCache.txt
   cmake ..
   make -j$(nproc)

2. ç·¨è­¯æ¨¡å‹ä¸¦è§€å¯Ÿ debug è¨Šæ¯ï¼š

   export LD_LIBRARY_PATH=/usr/lib/x86_64-linux-gnu:/usr/local/lib
   /usr/bin/python3 rvv_test.py mobilenet 2>&1 | tee compile_log.txt

3. æª¢æŸ¥è¼¸å‡ºï¼š

   grep "my_device" compile_log.txt

   æ‡‰è©²çœ‹åˆ° "Using LLVM backend mode"

======================================================================
ğŸ“š åƒè€ƒæ–‡æª”
======================================================================

- FIX_LLVM_MODE.md - å®Œæ•´ä¿®å¾©æŒ‡å—
- DEBUG_SUMMARY.md - å•é¡Œè¨ºæ–·ç¸½çµ  
- VERIFY_LLVM_CONFIG.md - é©—è­‰æ–¹æ³•è©³è§£
- check_build_llvm.sh - è‡ªå‹•æª¢æŸ¥è…³æœ¬
- test_llvm_codegen.py - Python æ¸¬è©¦è…³æœ¬

======================================================================

